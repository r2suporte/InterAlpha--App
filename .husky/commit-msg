#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Ler a mensagem do commit
commit_msg=$(cat "$1")

echo "ğŸ“ Validando mensagem do commit..."

# Verificar se a mensagem nÃ£o estÃ¡ vazia
if [ -z "$commit_msg" ]; then
  echo "âŒ Mensagem de commit nÃ£o pode estar vazia"
  exit 1
fi

# Verificar comprimento mÃ­nimo
if [ ${#commit_msg} -lt 10 ]; then
  echo "âŒ Mensagem de commit muito curta (mÃ­nimo 10 caracteres)"
  echo "ğŸ’¡ Dica: Descreva claramente o que foi alterado"
  exit 1
fi

# Verificar comprimento mÃ¡ximo da primeira linha
first_line=$(echo "$commit_msg" | head -n1)
if [ ${#first_line} -gt 72 ]; then
  echo "âŒ Primeira linha da mensagem muito longa (mÃ¡ximo 72 caracteres)"
  echo "ğŸ’¡ Dica: Mantenha o tÃ­tulo conciso e use o corpo para detalhes"
  exit 1
fi

# Verificar padrÃµes de commit convencionais (opcional, mas recomendado)
if echo "$first_line" | grep -qE '^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .+'; then
  echo "âœ… Formato de commit convencional detectado"
elif echo "$first_line" | grep -qE '^(add|update|remove|fix|improve|implement|create|delete): .+'; then
  echo "âœ… Formato de commit descritivo detectado"
else
  echo "âš ï¸  Considere usar commits convencionais:"
  echo "   feat: nova funcionalidade"
  echo "   fix: correÃ§Ã£o de bug"
  echo "   docs: documentaÃ§Ã£o"
  echo "   style: formataÃ§Ã£o"
  echo "   refactor: refatoraÃ§Ã£o"
  echo "   test: testes"
  echo "   chore: manutenÃ§Ã£o"
fi

# Verificar se nÃ£o contÃ©m palavras proibidas
if echo "$commit_msg" | grep -iqE '(wip|todo|fixme|hack|temp|debug)'; then
  echo "âš ï¸  Mensagem contÃ©m palavras que indicam trabalho incompleto"
  echo "ğŸ’¡ Considere finalizar o trabalho antes do commit"
fi

echo "âœ… Mensagem de commit validada!"